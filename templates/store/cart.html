{% extends 'base.html' %}
{% load static %}

{% block title %}Cart - CLAWS{% endblock %}

{% block content %}
<section class="cart-editorial">
    <div class="container-editorial">
        <div class="cart-header animate-fade-up">
            <h1 class="cart-title">YOUR CART</h1>
            <p class="cart-subtitle">Review your selected pieces before checkout</p>
        </div>

        {% if cart and cart.items.all %}
        <div class="cart-content">
            <div class="cart-items animate-on-scroll" data-delay="0.2s">
                <div class="cart-items-header">
                    <span class="header-product">PRODUCT</span>
                    <span class="header-price">PRICE</span>
                    <span class="header-quantity">QUANTITY</span>
                    <span class="header-total">TOTAL</span>
                    <span class="header-actions"></span>
                </div>
                
                <div class="cart-items-list" id="cartItemsList">
                    {% for item in cart.items.all %}
                    <div class="cart-item-unique animate-slide-in" data-item-id="{{ item.id }}" data-delay="{{ forloop.counter0|floatformat:1 }}s">
                        <div class="item-surface">
                            <div class="item-image-slot">
                                {% if item.product.get_image_url %}
                                <img src="{{ item.product.get_image_url }}" alt="{{ item.product.name }}" loading="lazy">
                                {% endif %}
                            </div>
                            
                            <div class="item-content">
                                <div class="item-header">
                                    <h3 class="item-name">{{ item.product.name }}</h3>
                                    <div class="item-price">${{ item.product.price }}</div>
                                </div>
                                
                                <div class="item-meta">
                                    <span class="item-category">{{ item.product.category.name }}</span>
                                    <span class="item-size">{{ item.size }}</span>
                                </div>
                                
                                <div class="item-controls">
                                    <div class="quantity-wrapper">
                                        <button class="qty-btn decrease" data-item-id="{{ item.id }}">âˆ’</button>
                                        <span class="qty-display">{{ item.quantity }}</span>
                                        <button class="qty-btn increase" data-item-id="{{ item.id }}">+</button>
                                    </div>
                                    
                                    <button class="remove-item" data-item-id="{{ item.id }}" title="Remove">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="item-total-badge">
                                <span class="total-amount">${{ item.get_total_price }}</span>
                            </div>
                        </div>
                        
                        <div class="item-shadow"></div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="cart-summary animate-on-scroll" data-delay="0.4s">
                <div class="summary-card">
                    <h3 class="summary-title">ORDER SUMMARY</h3>
                    
                    <div class="summary-details">
                        <div class="summary-row">
                            <span class="summary-label">Subtotal</span>
                            <span class="summary-value" id="subtotalAmount">
                                ${% widthratio cart.items.all|length 1 cart.items.all.0.product.price %}
                            </span>
                        </div>
                        
                        <div class="summary-row">
                            <span class="summary-label">Shipping</span>
                            <span class="summary-value shipping-value" id="shippingAmount">
                                <span class="free-shipping">FREE</span>
                            </span>
                        </div>
                        
                        <div class="summary-row">
                            <span class="summary-label">Tax</span>
                            <span class="summary-value" id="taxAmount">$0.00</span>
                        </div>
                        
                        <div class="summary-divider"></div>
                        
                        <div class="summary-row summary-total">
                            <span class="summary-label">Total</span>
                            <span class="summary-value" id="totalAmount">
                                ${% widthratio cart.items.all|length 1 cart.items.all.0.product.price %}
                            </span>
                        </div>
                    </div>
                    
                    <div class="promo-code">
                        <div class="promo-input-group">
                            <input type="text" class="promo-input" placeholder="Enter promo code" id="promoCodeInput">
                            <button type="button" class="promo-btn" id="applyPromoBtn">APPLY</button>
                        </div>
                        <div class="promo-message" id="promoMessage"></div>
                    </div>
                    
                    <div class="checkout-actions">
                        <a href="{% url 'store:checkout' %}" class="checkout-btn">
                            <span class="btn-text">PROCEED TO CHECKOUT</span>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/>
                            </svg>
                        </a>
                        
                        <div class="payment-options">
                            <span class="payment-label">Express checkout:</span>
                            <div class="payment-buttons">
                                <button class="payment-btn paypal-btn">
                                    <svg width="80" height="20" viewBox="0 0 80 20" fill="currentColor">
                                        <path d="M7.076 0C3.17 0 0 2.84 0 6.32c0 3.48 3.17 6.32 7.076 6.32s7.076-2.84 7.076-6.32C14.152 2.84 10.982 0 7.076 0z"/>
                                    </svg>
                                </button>
                                <button class="payment-btn apple-pay-btn">
                                    <svg width="40" height="20" viewBox="0 0 40 20" fill="currentColor">
                                        <path d="M8.5 0C7.119 0 5.5 1.119 5.5 2.5S7.119 5 8.5 5 11.5 3.881 11.5 2.5 9.881 0 8.5 0z"/>
                                    </svg>
                                </button>
                                <button class="payment-btn google-pay-btn">
                                    <svg width="40" height="20" viewBox="0 0 40 20" fill="currentColor">
                                        <path d="M20 10c0-5.523-4.477-10-10-10S0 4.477 0 10s4.477 10 10 10 10-4.477 10-10z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Trust Indicators -->
                <div class="trust-indicators">
                    <div class="trust-item">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
                        </svg>
                        <span>Secure Checkout</span>
                    </div>
                    <div class="trust-item">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        <span>Free Returns</span>
                    </div>
                    <div class="trust-item">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9z"/>
                        </svg>
                        <span>2-3 Day Shipping</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Continue Shopping -->
        <div class="continue-shopping animate-fade-up" data-delay="0.6s">
            <a href="{% url 'store:product_list' %}" class="continue-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
                CONTINUE SHOPPING
            </a>
        </div>
        
        {% else %}
        <!-- Empty Cart / Login Required -->
        <div class="empty-cart animate-on-scroll">
            <div class="empty-content">
                {% if not user.is_authenticated %}
                <div class="empty-icon">
                    <svg width="120" height="120" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1L13.5 2.5L16.17 5.17L10.59 10.75C10.21 11.13 10 11.63 10 12.17V23H12V12.17L13.5 10.67L15.5 12.67V23H17.5V11.5L15.5 9.5L17.83 7.17L20.5 9.83L22 8.33L21 9Z"/>
                    </svg>
                </div>
                <h2>Login Required</h2>
                <p>Please login to view your cart and manage your items.</p>
                <div class="empty-actions">
                    <a href="{% url 'account_login' %}" class="btn-primary">LOGIN</a>
                    <a href="{% url 'account_signup' %}" class="btn-secondary">SIGN UP</a>
                </div>
                {% else %}
                <div class="empty-icon">
                    <svg width="120" height="120" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7 4V2C7 1.45 7.45 1 8 1h8c.55 0 1 .45 1 1v2h5c.55 0 1 .45 1 1s-.45 1-1 1h-1v14c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V6H2c-.55 0-1-.45-1-1s.45-1 1-1h5zM9 3v1h6V3H9zm1 5v10h1V8H10zm3 0v10h1V8h-1z"/>
                    </svg>
                </div>
                <h2>Your Cart is Empty</h2>
                <p>Looks like you haven't added any items to your cart yet. Start exploring our latest drops.</p>
                <div class="empty-actions">
                    <a href="{% url 'store:product_list' %}" class="btn-primary">SHOP NOW</a>
                    <a href="{% url 'store:home' %}" class="btn-secondary">EXPLORE COLLECTIONS</a>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Remove Confirmation Modal -->
<div class="remove-modal" id="removeModal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Remove Item</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to remove this item from your cart?</p>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" id="cancelRemove">Cancel</button>
            <button class="btn-primary" id="confirmRemove">Remove</button>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner">
        <div class="spinner-ring"></div>
        <span class="loading-text">Updating cart...</span>
    </div>
</div>
{% endblock %}